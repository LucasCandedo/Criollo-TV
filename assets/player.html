<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>CriolloTV - Player</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --bg: #0a0a0f;
      --surface: rgba(15, 15, 25, 0.92);
      --accent: #3b82f6;
      --accent2: #60a5fa;
      --text: #f0f0f0;
      --muted: rgba(255,255,255,0.45);
      --danger: #ef4444;
    }

    html, body {
      width: 100%; height: 100%;
      background: var(--bg);
      overflow: hidden;
      font-family: 'Segoe UI', system-ui, sans-serif;
    }

    /* ‚îÄ‚îÄ‚îÄ LOADING SCREEN ‚îÄ‚îÄ‚îÄ */
    #loading {
      position: fixed; inset: 0;
      background: var(--bg);
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      gap: 24px; z-index: 100;
      transition: opacity 0.4s ease;
    }
    #loading.hidden { opacity: 0; pointer-events: none; }

    .loader-ring {
      width: 56px; height: 56px;
      border: 3px solid rgba(59,130,246,0.2);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin 0.9s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    .loader-text {
      color: var(--text); font-size: 1.1rem; font-weight: 500;
      letter-spacing: 0.02em;
    }
    .loader-channel {
      color: var(--accent2); font-size: 0.85rem;
    }

    /* ‚îÄ‚îÄ‚îÄ VIDEO CONTAINER ‚îÄ‚îÄ‚îÄ */
    #player-wrap {
      position: relative; width: 100%; height: 100%;
    }

    #yt-frame {
      width: 100%; height: 100%;
      border: none; display: block;
      background: #000;
    }

    /* ‚îÄ‚îÄ‚îÄ OVERLAY (tap to show controls) ‚îÄ‚îÄ‚îÄ */
    #tap-overlay {
      position: absolute; inset: 0;
      z-index: 10;
      cursor: pointer;
    }

    /* ‚îÄ‚îÄ‚îÄ CONTROLS BAR ‚îÄ‚îÄ‚îÄ */
    #controls {
      position: absolute; bottom: 0; left: 0; right: 0;
      background: linear-gradient(transparent, rgba(0,0,0,0.85) 40%);
      padding: 40px 16px 16px;
      display: flex; align-items: center; justify-content: space-between;
      gap: 12px;
      z-index: 20;
      transition: opacity 0.35s ease, transform 0.35s ease;
    }
    #controls.hidden {
      opacity: 0;
      transform: translateY(10px);
      pointer-events: none;
    }

    .ctrl-left { display: flex; align-items: center; gap: 10px; flex: 1; min-width: 0; }
    .ctrl-right { display: flex; align-items: center; gap: 8px; flex-shrink: 0; }

    /* Back button */
    #btn-back {
      display: flex; align-items: center; justify-content: center;
      width: 44px; height: 44px; flex-shrink: 0;
      background: rgba(255,255,255,0.12);
      border: 1px solid rgba(255,255,255,0.18);
      border-radius: 50%;
      cursor: pointer; color: var(--text);
      transition: background 0.2s, transform 0.15s;
      -webkit-tap-highlight-color: transparent;
    }
    #btn-back:hover, #btn-back:focus { background: rgba(255,255,255,0.22); outline: 2px solid var(--accent); }
    #btn-back:active { transform: scale(0.92); }

    #channel-name {
      color: var(--text); font-size: 1rem; font-weight: 600;
      white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
      text-shadow: 0 1px 4px rgba(0,0,0,0.8);
    }

    /* Live badge */
    .live-badge {
      display: flex; align-items: center; gap: 5px;
      background: var(--danger);
      color: white; font-size: 0.7rem; font-weight: 700;
      padding: 3px 8px; border-radius: 4px;
      letter-spacing: 0.05em; flex-shrink: 0;
    }
    .live-dot {
      width: 6px; height: 6px; border-radius: 50%;
      background: white;
      animation: pulse 1.5s ease infinite;
    }
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.4; }
    }

    /* Fullscreen button */
    #btn-fs {
      display: flex; align-items: center; justify-content: center;
      width: 40px; height: 40px;
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.15);
      border-radius: 8px;
      cursor: pointer; color: var(--text);
      transition: background 0.2s;
      -webkit-tap-highlight-color: transparent;
    }
    #btn-fs:hover, #btn-fs:focus { background: rgba(255,255,255,0.2); outline: 2px solid var(--accent); }

    /* ‚îÄ‚îÄ‚îÄ TOP BAR (channel name on top for TV) ‚îÄ‚îÄ‚îÄ */
    #top-bar {
      position: absolute; top: 0; left: 0; right: 0;
      padding: 16px;
      background: linear-gradient(rgba(0,0,0,0.7), transparent);
      z-index: 20;
      transition: opacity 0.35s ease;
    }
    #top-bar.hidden { opacity: 0; pointer-events: none; }

    /* ‚îÄ‚îÄ‚îÄ ERROR SCREEN ‚îÄ‚îÄ‚îÄ */
    #error-screen {
      position: fixed; inset: 0;
      background: var(--bg);
      display: none; flex-direction: column;
      align-items: center; justify-content: center;
      gap: 16px; z-index: 200; padding: 24px; text-align: center;
    }
    #error-screen.show { display: flex; }
    .error-icon { font-size: 3rem; }
    .error-title { color: var(--text); font-size: 1.3rem; font-weight: 700; }
    .error-msg { color: var(--muted); font-size: 0.9rem; }
    .btn-retry {
      margin-top: 8px; padding: 10px 28px;
      background: var(--accent); color: white;
      border: none; border-radius: 8px;
      font-size: 0.95rem; font-weight: 600;
      cursor: pointer; transition: background 0.2s;
    }
    .btn-retry:hover { background: var(--accent2); }

    /* ‚îÄ‚îÄ‚îÄ ANDROID TV: D-PAD FOCUS STYLES ‚îÄ‚îÄ‚îÄ */
    @media (hover: none) and (pointer: coarse) {
      #btn-back, #btn-fs { min-width: 56px; min-height: 56px; }
    }

    /* TV cursor navigation highlight */
    :focus-visible {
      outline: 3px solid var(--accent) !important;
      outline-offset: 2px;
    }
  </style>
</head>
<body>

<!-- Loading -->
<div id="loading">
  <div class="loader-ring"></div>
  <div class="loader-text">Cargando canal...</div>
  <div class="loader-channel" id="loading-channel"></div>
</div>

<!-- Error -->
<div id="error-screen">
  <div class="error-icon">üì°</div>
  <div class="error-title">Sin se√±al</div>
  <div class="error-msg" id="error-msg">No se pudo conectar con el canal.</div>
  <button class="btn-retry" onclick="goBack()">‚Üê Volver</button>
</div>

<!-- Player -->
<div id="player-wrap">
  <!-- Tap overlay para mostrar/ocultar controles en touch -->
  <div id="tap-overlay" onclick="toggleControls()"></div>

  <iframe
    id="yt-frame"
    allow="autoplay; fullscreen; accelerometer; gyroscope; picture-in-picture"
    allowfullscreen
    referrerpolicy="no-referrer-when-downgrade"
  ></iframe>

  <!-- Top bar -->
  <div id="top-bar">
    <div class="live-badge">
      <div class="live-dot"></div>
      EN VIVO
    </div>
  </div>

  <!-- Controls -->
  <div id="controls">
    <div class="ctrl-left">
      <button id="btn-back" onclick="goBack()" tabindex="1" aria-label="Volver">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="15 18 9 12 15 6"/>
        </svg>
      </button>
      <span id="channel-name">Canal</span>
    </div>
    <div class="ctrl-right">
      <button id="btn-fs" onclick="toggleFullscreen()" tabindex="2" aria-label="Pantalla completa">
        <svg id="fs-icon-expand" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="15 3 21 3 21 9"/><polyline points="9 21 3 21 3 15"/>
          <line x1="21" y1="3" x2="14" y2="10"/><line x1="3" y1="21" x2="10" y2="14"/>
        </svg>
        <svg id="fs-icon-shrink" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:none">
          <polyline points="4 14 10 14 10 20"/><polyline points="20 10 14 10 14 4"/>
          <line x1="10" y1="14" x2="3" y2="21"/><line x1="21" y1="3" x2="14" y2="10"/>
        </svg>
      </button>
    </div>
  </div>
</div>

<script>
  // ‚îÄ‚îÄ‚îÄ PARAMS ‚îÄ‚îÄ‚îÄ
  const params = new URLSearchParams(window.location.search);
  const videoId = params.get('v');
  const channelName = params.get('name') || 'Canal';
  const backUrl = params.get('back') || '/';

  // ‚îÄ‚îÄ‚îÄ INIT ‚îÄ‚îÄ‚îÄ
  document.getElementById('channel-name').textContent = channelName;
  document.getElementById('loading-channel').textContent = channelName;

  if (!videoId) {
    showError('No se especific√≥ ning√∫n canal.');
  } else {
    loadPlayer(videoId);
  }

  function loadPlayer(id) {
    const frame = document.getElementById('yt-frame');
    const src = `https://www.youtube.com/embed/${id}?autoplay=1&controls=1&rel=0&modestbranding=1&playsinline=1&enablejsapi=1`;
    frame.src = src;

    // Ocultar loading cuando el iframe cargue
    frame.onload = () => {
      setTimeout(() => {
        document.getElementById('loading').classList.add('hidden');
        startHideTimer();
      }, 800);
    };

    // Timeout por si no carga
    setTimeout(() => {
      if (!document.getElementById('loading').classList.contains('hidden')) {
        showError('El canal tard√≥ demasiado en cargar. Intent√° de nuevo.');
      }
    }, 15000);
  }

  // ‚îÄ‚îÄ‚îÄ CONTROLES AUTO-HIDE ‚îÄ‚îÄ‚îÄ
  let hideTimer = null;
  let controlsVisible = true;

  function showControls() {
    document.getElementById('controls').classList.remove('hidden');
    document.getElementById('top-bar').classList.remove('hidden');
    controlsVisible = true;
    startHideTimer();
  }

  function hideControls() {
    document.getElementById('controls').classList.add('hidden');
    document.getElementById('top-bar').classList.add('hidden');
    controlsVisible = false;
  }

  function toggleControls() {
    if (controlsVisible) {
      hideControls();
    } else {
      showControls();
    }
  }

  function startHideTimer() {
    clearTimeout(hideTimer);
    hideTimer = setTimeout(hideControls, 4000);
  }

  // Mostrar controles en cualquier interacci√≥n
  document.addEventListener('mousemove', showControls);
  document.addEventListener('touchstart', () => {}, { passive: true });
  document.addEventListener('keydown', (e) => {
    showControls();
    handleKeyboard(e);
  });

  // ‚îÄ‚îÄ‚îÄ TECLADO / D-PAD (Android TV) ‚îÄ‚îÄ‚îÄ
  function handleKeyboard(e) {
    switch(e.key) {
      case 'Escape':
      case 'Backspace':
      case 'XF86Back':
        e.preventDefault();
        goBack();
        break;
      case 'f':
      case 'F':
      case 'Enter':
        if (document.activeElement === document.getElementById('btn-fs') ||
            document.activeElement === document.body) {
          toggleFullscreen();
        }
        break;
      // D-pad navegaci√≥n
      case 'ArrowLeft':
      case 'ArrowRight':
      case 'ArrowUp':
      case 'ArrowDown':
        showControls();
        break;
    }
  }

  // ‚îÄ‚îÄ‚îÄ FULLSCREEN ‚îÄ‚îÄ‚îÄ
  function toggleFullscreen() {
    if (!document.fullscreenElement) {
      document.documentElement.requestFullscreen().catch(() => {});
      document.getElementById('fs-icon-expand').style.display = 'none';
      document.getElementById('fs-icon-shrink').style.display = 'block';
    } else {
      document.exitFullscreen();
      document.getElementById('fs-icon-expand').style.display = 'block';
      document.getElementById('fs-icon-shrink').style.display = 'none';
    }
  }

  document.addEventListener('fullscreenchange', () => {
    if (!document.fullscreenElement) {
      document.getElementById('fs-icon-expand').style.display = 'block';
      document.getElementById('fs-icon-shrink').style.display = 'none';
    }
  });

  // ‚îÄ‚îÄ‚îÄ BACK ‚îÄ‚îÄ‚îÄ
  function goBack() {
    window.location.href = backUrl;
  }

  // ‚îÄ‚îÄ‚îÄ ERROR ‚îÄ‚îÄ‚îÄ
  function showError(msg) {
    document.getElementById('loading').classList.add('hidden');
    document.getElementById('error-msg').textContent = msg;
    document.getElementById('error-screen').classList.add('show');
  }

  // ‚îÄ‚îÄ‚îÄ AUTO FULLSCREEN en Android TV ‚îÄ‚îÄ‚îÄ
  // Si viene de un TV, entrar en fullscreen autom√°ticamente
  const isTV = navigator.userAgent.includes('TV') ||
               navigator.userAgent.includes('SmartTV') ||
               window.matchMedia('(pointer: coarse) and (hover: none)').matches;

  if (isTV) {
    document.addEventListener('click', function initFs() {
      document.documentElement.requestFullscreen().catch(() => {});
      document.removeEventListener('click', initFs);
    }, { once: true });
  }
</script>
</body>
</html>
